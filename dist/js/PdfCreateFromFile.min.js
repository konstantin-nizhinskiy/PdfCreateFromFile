/*
name: pdf-create-from-file
version: 1.0.0
author: Konstantin Nizhinskiy
date: 2017-03-07 10:03:51 

*/
!function(a,b){if("function"==typeof define&&define.amd)define(["pdfMake"],b);else if("object"==typeof module&&module.exports)module.exports=b(require("pdfMake"));else{if(!a.pdfMake)throw"not fount module pdfMake https://bpampuch.github.io/pdfmake";a.PdfCreateFromFile=b(a.pdfMake)}}(this,function(a){function b(a,b,c,e){var f=[],g=b.childNodes;if(0!=g.length)for(var h=0;h<g.length;h++)c=d(f,g[h],c,e);if(0!=f.length)for(var h=0;h<f.length;h++)a.push(f[h]);return c}function c(a,b){b.forEach(function(b){var c=b.trim().toLowerCase().split(":"),d=c[0],e=c[1];if(2==c.length)switch(d){case"padding-left":a.margin=[parseInt(e),0,0,0];break;case"font-size":a.fontSize=parseInt(e);break;case"text-align":switch(e){case"right":case"center":case"justify":a.alignment=e}break;case"font-weight":switch(e){case"bold":a.bold=!0}break;case"text-decoration":switch(e){case"underline":a.decoration="underline";break;case"line-through":a.decoration="lineThrough"}break;case"font-style":switch(e){case"italic":a.italics=!0}break;case"color":a.color=e;break;case"background-color":a.background=e}})}function d(a,d,f,g){var h={b:["font-weight:bold"],strong:["font-weight:bold"],u:["text-decoration:underline"],em:["font-style:italic"],i:["font-style:italic"],h1:["font-size:16","font-weight:bold"],h2:["font-size:12","font-weight:bold"],h3:["font-size:10","font-weight:bold"],h4:["font-size:10","font-style:italic"],h5:["font-size:10"],h6:["font-size:10"],a:["color:blue","text-decoration:underline"],del:["color:red","text-decoration:line-through"],ins:["color:green","text-decoration:underline"]};if(g||(g=[]),g=g.concat(h[d.nodeName.toLowerCase()]||[]),d.getAttribute){var i=d.getAttribute("style");if(i)for(var j=i.split(";"),k=0;k<j.length;k++)g.push(j[k])}switch(d.nodeName.toLowerCase()){case"#text":var l={text:d.textContent.replace(/\n/g,"")};g&&c(l,g),f.text.push(l);break;case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":f.marginTop=5,f.marginBottom=5,b(a,d,f,g);break;case"b":case"strong":case"u":case"em":case"i":case"ins":case"del":b(a,d,f,g);break;case"span":b(a,d,f,g);break;case"br":f=e(),f.text=["\n"],a.push(f);break;case"table":var l={table:{widths:[],body:[]}},m=d.getAttribute("border"),n=!1;m&&1==parseInt(m)&&(n=!0),n||(l.layout="noBorders"),b(l.table.body,d,f,g);var o=d.getAttribute("widths");if(o)for(var p=o.split(","),k=0;k<p.length;k++)l.table.widths.push(p[k]);else if(0!=l.table.body.length&&0!=l.table.body[0].length)for(var k=0;k<l.table.body[0].length;k++)l.table.widths.push("*");a.push(l);break;case"tbody":b(a,d,f,g);break;case"tr":var q=[];b(q,d,f,g),a.push(q);break;case"td":f=e();var r={stack:[]};r.stack.push(f);var s=d.getAttribute("rowspan");s&&(r.rowSpan=parseInt(s));var t=d.getAttribute("colspan");t&&(r.colSpan=parseInt(t)),b(r.stack,d,f,g),a.push(r);break;case"div":case"p":f=e();var r={stack:[]};r.stack.push(f),c(r,g),b(r.stack,d,f),a.push(r)}return f}function e(){return{text:[]}}var f=function(a){if(a=a||{},"setLocales"==a)return function(a,b){m.locales[a]=b};if(this._wrapper=a.wrapper||document.body,this._locale=a.locale||"en",this._typeOpen=a.typeOpen||"download",this._documentName=a.documentName||"Document",this._callback=a.callback,this._locales=a.locales||!1,this._storageId=a.storageId||+new Date,a.locales)for(var b in a.locales)m.locales[b]=a.locales[b];if(l[this._storageId]||(l[this._storageId]=[]),g.indexOf(this._typeOpen)<0)throw"Not fount typeOpen ["+this._typeOpen+"]";if(k.indexOf(this._typeOpen)>-1&&"function"!=typeof this._callback)throw"Set function callback in param callback"},g=["download","open","print","getBase64","getBlob","getDataUrl"],h=["BMP","JPEG","JPG","JPE","JP2","PNG","IMAGE"],i=["TXT","LOG","JS","TEX","TEXT"],j=["HTML"],k=["getBase64","getBlob","getDataUrl"],l=[],m={localesDefault:{errorArrayLoadFile:"Please delete all not support file",errorTypeFileNotSupport:"This type file not support",btnNameClose:"Close",btnNameAddFile:"Add file",btnNameDelete:"Delete",title:"Create PDF file",btnNameCreate:"Create PDF",textFileSize:"File size",textFileName:"File name",textDrop:"Drag a file here",textOr:"or"},locales:{}},n=function(a,b){var c=b.className;c.indexOf(a)==-1&&(""!=c&&(a=" "+a),b.className=c+a)},o=function(a){var b,c=+new Date,d=document.createElement("div");return b=function(){for(var e=u({id:c,storageId:a.storageId,locales:a.locales}),f=e.getElementsByClassName("btn-delete"),g=0;g<f.length;g++)f[g].onclick=function(c){var e=[],f=c.target.dataset.id;l[a.storageId].forEach(function(a,b){f!=b&&e.push(a)}),l[a.storageId]=e,d.children.length&&d.children[0].remove(),l[a.storageId].forEach(function(b){b.isSupport=r(b.typeName,a.storageId)}),s(a.storageId),d.appendChild(b())};return e},d.appendChild(b()),d},p=function(a){var b=+new Date,c=v({id:b,locales:a.locales}),d=this,e=c.getElementsByClassName("drop-zone")[0],f=c.getElementsByClassName("file-load")[0],g=c.getElementsByClassName("text-error")[0];return f.addEventListener("change",function(b){g.innerText="",d.addFile(b.target.files[0],{success:a.success,error:function(a){g.innerText=a}})}),e.ondragover=function(){return g.innerText="",n("hover",e),!1},e.ondragleave=function(){return g.innerText="",t("hover",e),!1},e.ondrop=function(b){b.preventDefault(),g.innerText="",t("hover",e),n("drop",e);var c=b.dataTransfer.files[0];d.addFile(c,{success:a.success,error:function(a){g.innerText=a}})},c},q=function(a){var b;if(b=m.locales[a]?m.locales[a]:m.localesDefault,this._locales)for(var c in this._locales)b[c]=this._locales[c];return b},r=function(a,b,c){return h.indexOf(a.toUpperCase())>-1||(i.indexOf(a.toUpperCase())>-1||(j.indexOf(a.toUpperCase())>-1||"PDF"==a.toUpperCase()&&l[b].length==c))},s=function(a){l[a].forEach(function(b){b.isSupport=r(b.typeName,a,1)})};ParseHtml=function(a,b){var c=document.createElement("div");c.innerHTML=a,b=b||[];for(var f=0;f<c.children.length;f++)["div","p","table"].indexOf(c.children[f].nodeName.toLowerCase())<0?b.push(d(b,c.children[f],e(),[])):d(b,c.children[f],e(),[]);return b};var t=function(a,b){var c=b.className,d=new RegExp("\\s?\\b"+a+"\\b","g");c=c.replace(d,""),b.className=c},u=function(a){var b=document.createElement("div");return l[a.storageId].forEach(function(c,d){var e,f=document.createElement("div"),g="";f.className="",c.isSupport===!1&&(f.className=" error-support",g='<div class="text-error">'+a.locales.errorTypeFileNotSupport+"</div>"),e="image"==c.typeName?'<img src="'+c.content+'" alt="" class="img-rounded">':'<div class="img-rounded">'+c.typeName+"</div>",f.className+=" wrapper-img",f.innerHTML=e+'<div class="block-info"><div><div class="label-file">'+a.locales.textFileName+'</div><div class="info-file">'+c.name+'</div></div><div><div class="label-file">'+a.locales.textFileSize+'</div><div class="info-file">'+c.sizeName+"</div></div>"+g+'<div><button type="button" class="btn btn-default btn-delete " data-id="'+d+'" >'+a.locales.btnNameDelete+"</button></div></div>",b.appendChild(f)}),b},v=function(a){var b=document.createElement("div");return b.innerHTML='<div class="drop-zone"><div>'+a.locales.textDrop+"</div><div>"+a.locales.textOr+'</div><div class="text-error"></div><div class="fm-drop-zone-message"><div><input class="file-load" type="file"></div></div></div></div>',b},w=function(a){var b=document.createElement("div");return b.className="wrapper-pdf-waite",b.innerHTML='<div class="floatingCirclesG"><div class="f_circleG frotateG_01"></div><div class="f_circleG frotateG_02"></div><div class="f_circleG frotateG_03"></div><div class="f_circleG frotateG_04"></div><div class="f_circleG frotateG_05"></div><div class="f_circleG frotateG_06"></div><div class="f_circleG frotateG_07"></div><div class="f_circleG frotateG_08"></div></div>',b},x=function(a){var b=document.createElement("div"),c=window.innerHeight;return b.innerHTML='<div class="wrapper-pdf-create"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header">'+a.locales.title+'</div><div class="modal-body" style="max-height: '+c+'px" ></div><div class="modal-footer"><button type="button" class="btn btn-default btn-close " data-dismiss="modal">'+a.locales.btnNameClose+'</button><button type="button" class="btn btn-primary btn-add">'+a.locales.btnNameAddFile+'</button><span class="error-footer text-error"></span><button type="button" class="btn btn-success btn-save">'+a.locales.btnNameCreate+"</button></div></div></div></div>",b};f.prototype.addFile=function(a,b){var c,d=new FileReader,e=this,f=q.call(this,this._locale);if(a.type.indexOf("image")>-1)c="image";else if(a.type.indexOf("html")>-1)c="html";else if(a.type.indexOf("text")>-1||a.type.indexOf("application")>-1)c="text";else if(a.type.indexOf("pdf")>-1)c="pdf";else{if(!(a.type.indexOf("zip")>-1))return b.error(f.errorTypeFileNotSupport),!1;c="zip",JSZip().loadAsync(a).then(function(a){for(var c in a.files)!function(a){!function(a,c){var d="base64",f="";h.indexOf(a.toUpperCase())>-1?(f="data:image/"+a.toLowerCase()+";base64,",a="image",d="base64"):i.indexOf(a.toUpperCase())>-1?(a="text",d="string"):j.indexOf(a.toUpperCase())>-1&&(a="html",d="string"),c.async(d).then(function(d){l[e._storageId].push({lastModified:+c.date,name:c.name,size:0,sizeName:"ZIP",type:a,typeName:a,content:f+d}),s(e._storageId),b.success()})}(a.name.split(".").pop(),a)}(a.files[c])})}"zip"!=c&&(d.onload=function(d){var f=function(a){var b=Math.floor(Math.log(a)/Math.log(1024));return 1*(a/Math.pow(1024,b)).toFixed(2)+" "+["B","kB","MB","GB","TB"][b]};l[e._storageId].push({lastModified:a.lastModified,name:a.name,size:a.size,sizeName:f(a.size),type:a.type,typeName:c,content:d.target.result}),s(e._storageId),b.success()},i.indexOf(c.toUpperCase())>-1||j.indexOf(c.toUpperCase())>-1?d.readAsText(a,"UTF-8"):d.readAsDataURL(a))};var y={};return f.prototype.on=function(a,b){void 0===y[a]&&(y[a]={callback:[],callbackOnce:[]}),y[a].callback.push(b)},f.prototype.once=function(a,b){void 0===y[a]&&(y[a]={callback:[],callbackOnce:[]}),y[a].callbackOnce.push(b)},f.prototype.off=function(a,b){var c;if("function"==typeof b){if(y[a].callback&&y[a].callback.length>0){c=[];for(var d=0;d<y[a].callback.length;d++)"function"==typeof y[a].callback[d]&&y[a].callback[d]!==b&&c.push(y[a].callback[d]);y[a].callback=c}if(y[a].callbackOnce&&y[a].callbackOnce.length>0){c=[];for(var d=0;d<y[a].callbackOnce.length;d++)"function"==typeof y[a].callbackOnce[d]&&y[a].callbackOnce[d]!==b&&c.push(y[a].callbackOnce[d]);y[a].callbackOnce=c}}else delete y[a]},f.prototype.trigger=function(a){if(y[a]){var b=[];for(var c in arguments)0!=c&&b.push(arguments[c]);if(y[a].callback&&y[a].callback.length>0)for(var d=0;d<y[a].callback.length;d++)"function"==typeof y[a].callback[d]&&y[a].callback[d].apply(this,b);if(y[a].callbackOnce&&y[a].callbackOnce.length>0){for(var d=0;d<y[a].callbackOnce.length;d++)"function"==typeof y[a].callbackOnce[d]&&y[a].callbackOnce[d].apply(this,b);y[a].callbackOnce=[]}}},f.prototype.isValid=function(){var a=!0;return l[this._storageId].forEach(function(b){b.isSupport===!1&&(a=!1)}),a},f.prototype.openModal=function(a,b){if(a=a||this._typeOpen,g.indexOf(a)<0)throw"Not fount typeOpen ["+a+"]";if(k.indexOf(a)>-1&&"function"!=typeof b)throw"Set function callback in param callback";this._wrapper.appendChild(this.view(a,b))},f.prototype.view=function(a,b){var c=+new Date,d=this,e=q.call(this,this._locale),f=x({id:c,locales:e,btnNameClose:m.btnNameClose,btnNameAddFile:m.btnNameAddFile,btnNameCreate:m.btnNameCreate,title:m.title}),g=f.getElementsByClassName("modal-body")[0],h=f.getElementsByClassName("btn-close")[0],i=f.getElementsByClassName("btn-add")[0],j=f.getElementsByClassName("error-footer")[0],k=f.getElementsByClassName("btn-save")[0];return h.onclick=function(a){f.remove(),d.trigger("close")},k.onclick=function(c){if(j.innerText="",d.isValid()===!1)return j.innerText=e.errorArrayLoadFile,!1;if(1==l[d._storageId].length&&"PDF"==l[d._storageId][0].typeName.toUpperCase()){switch(a){case"getBase64":b(l[d._storageId][0].content.substring(l[d._storageId][0].content.indexOf("base64,")+7)),f.remove(),d.trigger("close");break;case"getDataUrl":b(l[d._storageId][0].content),f.remove(),d.trigger("close");break;default:j.innerText="Work only function callback getBase64 getDataUrl"}return!1}var g={content:[]};switch(l[d._storageId].forEach(function(a,b){"image"==a.typeName&&g.content.push({image:a.content,fit:[525,700]}),"html"==a.typeName&&ParseHtml(a.content,g.content),"text"==a.typeName&&g.content.push({text:a.content,fontSize:8})}),a){case"download":pdfMake.createPdf(g).download(d._documentName+".pdf");break;case"open":pdfMake.createPdf(g).open();break;case"print":pdfMake.createPdf(g).print();break;case"getBase64":d.waitStart(),pdfMake.createPdf(g).getBase64(function(a){b(a),d.waitStop()});break;case"getBlob":d.waitStart(),pdfMake.createPdf(g).getBlob(function(a){b(a),d.waitStop()});break;case"getDataUrl":d.waitStart(),pdfMake.createPdf(g).getDataUrl(function(a){b(a),d.waitStop()})}f.remove(),d.trigger("close")},i.onclick=function(a){i.style.display="none",k.style.display="none",d.trigger("add:file"),g.appendChild(p.call(d,{locales:e,success:function(){i.style.display="block",k.style.display="block",g.innerHTML="",g.appendChild(o({storageId:d._storageId,locales:e}))}})),g.scrollTop=g.scrollHeight},l[d._storageId].length?g.appendChild(o({storageId:d._storageId,locales:e})):(i.style.display="none",k.style.display="none",g.appendChild(p.call(d,{locales:e,success:function(){i.style.display="block",k.style.display="block",g.innerHTML="",g.appendChild(o({storageId:d._storageId,locales:e}))}}))),f},f.prototype.waitStart=function(){this._templateWait&&this._templateWait.remove(),this._templateWait=w({}),this._wrapper.appendChild(this._templateWait)},f.prototype.waitStop=function(a,b){this._templateWait&&this._templateWait.remove()},f});